FROM ubuntu:20.04
ENV DEBIAN_FRONTEND noninteractve
ENV BRANCH Oct2020

# install monetdb build dependencies
RUN apt-get update && \
    apt-get install -y cmake python3-dev python3-pip curl bison libpcre3-dev libssl-dev

# download and extract monetdb
WORKDIR /tmp 
RUN curl -O https://dev.monetdb.org/hg/MonetDB/archive/${BRANCH}.tar.bz2 
RUN tar jxvf ${BRANCH}.tar.bz2 
RUN mkdir /tmp/MonetDB-${BRANCH}/build
WORKDIR /tmp/MonetDB-${BRANCH}/build 
RUN cmake .. -DWITH_CRYPTO=OFF -DINT128=OFF -DPY3INTEGRATION=OFF -DCMAKE_BUILD_TYPE=Release -DASSERT=OFF
RUN make -j 4 
RUN make install 

# preinstall dependencies
RUN pip3 install --upgrade pip pytest numpy pandas mypy pycodestyle

# add shared libraries to wheels
ENV LD_LIBRARY_PATH "${LD_LIBRARY_PATH}:/usr/local/lib"

